let availableNumbers = [];
let minVal, maxVal;

function startLottery() {
  const minInput = document.getElementById('min').value;
  const maxInput = document.getElementById('max').value;

  minVal = parseInt(minInput);
  maxVal = parseInt(maxInput);

  if (isNaN(minVal) || isNaN(maxVal) || minVal > maxVal) {
    alert('لطفاً یک محدوده معتبر وارد کنید (عدد شروع باید کوچکتر یا مساوی عدد پایان باشد).');
    return;
  }

  availableNumbers = [];
  for (let i = minVal; i <= maxVal; i++) {
    availableNumbers.push(i);
  }

  document.getElementById('range-display').textContent = `${minVal} تا ${maxVal}`;
  document.getElementById('setup').classList.remove('active');
  document.getElementById('lottery').classList.add('active');
  document.getElementById('winner-number').innerHTML = '🏆'; // بازنشانی به آیکون جام
}

function drawNumber() {
  const drawBtn = document.getElementById('draw-btn');
  const winnerDisplay = document.getElementById('winner-number');

  if (availableNumbers.length === 0) {
    winnerDisplay.textContent = 'تمام شد!';
    drawBtn.disabled = true;
    return;
  }

  drawBtn.disabled = true; // غیرفعال کردن دکمه در حین انیمیشن

  // انیمیشن شمارش سریع اعداد
  let animationInterval = setInterval(() => {
    const randomNumber = Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
    winnerDisplay.textContent = randomNumber;
  }, 50); // هر 50 میلی‌ثانیه یک عدد تصادفی نشان بده

  // توقف انیمیشن بعد از 2.5 ثانیه و نمایش برنده واقعی
  setTimeout(() => {
    clearInterval(animationInterval);

    const randomIndex = Math.floor(Math.random() * availableNumbers.length);
    const winner = availableNumbers.splice(randomIndex, 1)[0];
    
    winnerDisplay.textContent = winner; // نمایش عدد برنده نهایی
    winnerDisplay.style.transform = 'scale(1.5)';
    winnerDisplay.style.transition = 'transform 0.3s ease';
    setTimeout(() => {
        winnerDisplay.style.transform = 'scale(1)';
    }, 300);


    if (availableNumbers.length === 0) {
        // اگر این آخرین عدد بود، پیام پایانی را نمایش بده
        setTimeout(() => {
            winnerDisplay.textContent = `🎉 ${winner}`;
            alert('🎉 همه اعداد قرعه‌کشی شدند!');
        }, 1500);
    } else {
        drawBtn.disabled = false; // فعال کردن مجدد دکمه
    }

  }, 2500); // مدت زمان کل انیمیشن
}

function resetLottery() {
  document.getElementById('lottery').classList.remove('active');
  document.getElementById('setup').classList.add('active');
  document.getElementById('draw-btn').disabled = false;
  document.getElementById('winner-number').innerHTML = '🏆';
  // پاک کردن ورودی‌ها برای شروع مجدد
  document.getElementById('min').value = '1';
  document.getElementById('max').value = '100';
}
